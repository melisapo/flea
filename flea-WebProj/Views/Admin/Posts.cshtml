@model flea_WebProj.Models.ViewModels.Admin.ManagePostsViewModel

@{
    ViewData["Title"] = "Gestión de Posts";
}

<div class="flex">
    <!-- Sidebar -->
    @await Html.PartialAsync("_AdminSidebar")

    <!-- Main Content Area -->
    <main class="flex-1 px-4 md:px-10">
        <div class="max-w-[1200px] mx-auto space-y-6">
            
            <!-- Page Heading -->
            <div class="flex flex-wrap items-end justify-between gap-4">
                <div class="flex flex-col gap-1">
                    <h1 class="text-[#25231e] dark:text-white text-3xl font-black tracking-tight">Gestión de Publicaciones</h1>
                    <p class="text-mutedForeground text-sm font-medium">@Model.Posts.Count publicación(es) en la plataforma</p>
                </div>
            </div>

            <!-- Data Table -->
            <div class="bg-white dark:bg-background-dark/50 border border-[#edf1e9] dark:border-white/5 rounded-xl overflow-hidden shadow-sm">
                @if (Model.Posts.Any())
                {
                    <div class="overflow-x-auto custom-scrollbar">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-[#fafbf9]/50 dark:bg-white/5 text-[#718d58] border-b border-[#edf1e9] dark:border-white/5">
                                    <th class="px-6 py-4 text-xs font-bold uppercase tracking-widest">Producto</th>
                                    <th class="px-6 py-4 text-xs font-bold uppercase tracking-widest">Precio</th>
                                    <th class="px-6 py-4 text-xs font-bold uppercase tracking-widest">Autor</th>
                                    <th class="px-6 py-4 text-xs font-bold uppercase tracking-widest">Estado</th>
                                    <th class="px-6 py-4 text-xs font-bold uppercase tracking-widest">Categorías</th>
                                    <th class="px-6 py-4 text-xs font-bold uppercase tracking-widest text-right">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-[#edf1e9] dark:divide-white/5">
                                @foreach (var post in Model.Posts)
                                {
                                    var isReported = !string.IsNullOrEmpty(post.Reported);
                                    
                                    <tr class="@(isReported ? "bg-destructive/10 border-l-4 border-destructive" : "hover:bg-[#fafbf9]/30 transition-colors")">
                                        <!-- Product -->
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-3">
                                                @if (!string.IsNullOrEmpty(post.MainImage))
                                                {
                                                    <div class="size-10 rounded-lg bg-center bg-cover border border-[#edf1e9] dark:border-white/10"
                                                         style="background-image: url('@post.MainImage')"></div>
                                                }
                                                else
                                                {
                                                    <div class="size-10 rounded-lg bg-gray-200 dark:bg-gray-700 border border-[#edf1e9] dark:border-white/10 flex items-center justify-center">
                                                        <span class="material-symbols-outlined text-gray-400 text-sm">image</span>
                                                    </div>
                                                }
                                                <div class="flex flex-col max-w-[200px]">
                                                    <span class="text-sm font-bold truncate">@post.Title</span>
                                                    <span class="text-xs text-[#718d58] truncate">
                                                        @(post.Description.Length > 40 ? post.Description[..40] + "..." : post.Description)
                                                    </span>
                                                </div>
                                            </div>
                                        </td>

                                        <!-- Price -->
                                        <td class="px-6 py-4">
                                            <span class="text-sm font-bold">$@post.Price.ToString("N2")</span>
                                        </td>

                                        <!-- Author -->
                                        <td class="px-6 py-4">
                                            <div class="flex flex-col">
                                                <span class="text-sm font-bold">@post.AuthorName</span>
                                                <span class="text-xs text-[#718d58]">@@@post.AuthorUsername</span>
                                            </div>
                                        </td>

                                        <!-- Status -->
                                        <td class="px-6 py-4">
                                            @switch (post.Status.ToString())
                                            {
                                                case "Available":
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-primary/20 text-[#4a7226] dark:text-primary">
                                                        Disponible
                                                    </span>
                                                    break;
                                                case "Sold":
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-gray-100 text-gray-600 dark:bg-white/10 dark:text-gray-400">
                                                        Vendido
                                                    </span>
                                                    break;
                                                case "Reserved":
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-amber-100 text-amber-700 dark:bg-amber-500/10 dark:text-amber-500">
                                                        Reservado
                                                    </span>
                                                    break;
                                                default:
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-blue-100 text-blue-700">
                                                        @post.StatusText
                                                    </span>
                                                    break;
                                            }
                                        </td>

                                        <!-- Categories -->
                                        <td class="px-6 py-4">
                                            <div class="flex flex-wrap gap-1">
                                                @foreach (var category in post.Categories)
                                                {
                                                    <span class="text-xs font-medium text-[#718d58] px-2 py-1 bg-[#fafbf9] dark:bg-white/5 rounded uppercase">
                                                        @category
                                                    </span>
                                                }
                                            </div>
                                        </td>

                                        <!-- Actions -->
                                        <td class="px-6 py-4 text-right">
                                            <div class="flex items-center justify-end gap-2">
                                                <a asp-controller="Posts"
                                                   asp-action="Details"
                                                   asp-route-id="@post.PostId"
                                                   target="_blank"
                                                   class="p-2 text-[#718d58] hover:text-primary hover:bg-primary/10 rounded-lg transition-all"
                                                   title="Ver Detalles">
                                                    <span class="material-symbols-outlined">visibility</span>
                                                </a>
                                                <a asp-action="DeletePostConfirm"
                                                   asp-route-id="@post.PostId"
                                                   class="p-2 text-[#718d58] hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all"
                                                   title="Eliminar">
                                                    <span class="material-symbols-outlined">delete</span>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="px-6 py-4 bg-[#fafbf9]/30 flex items-center justify-between border-t">
                        <span class="text-xs font-bold text-[#718d58] uppercase">
                            Página @Model.Page de @Model.TotalPages
                        </span>

                        <div class="flex gap-2">
                            @if (Model.Page > 1)
                            {
                                <a asp-action="Posts"
                                   asp-route-page="@(Model.Page - 1)"
                                   class="px-3 py-1 rounded bg-gray-200">
                                    Anterior
                                </a>
                            }

                            @if (Model.Page < Model.TotalPages)
                            {
                                <a asp-action="Posts"
                                   asp-route-page="@(Model.Page + 1)"
                                   class="px-3 py-1 rounded bg-gray-200">
                                    Siguiente
                                </a>
                            }
                        </div>
                    </div>

                }
                else
                {
                    <!-- Empty State -->
                    <div class="py-20 text-center">
                        <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center">
                            <span class="material-symbols-outlined text-gray-400 text-4xl">article</span>
                        </div>
                        <h3 class="text-lg font-bold text-[#25231e] dark:text-white mb-2">No hay publicaciones</h3>
                        <p class="text-sm text-[#718d58]">Las publicaciones aparecerán aquí cuando los usuarios las creen</p>
                    </div>
                }
            </div>

            <!-- Summary Footer Stats -->
            @if (Model.Posts.Any())
            {
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="p-4 bg-white dark:bg-background-dark/50 border border-[#edf1e9] dark:border-white/5 rounded-xl shadow-sm flex items-center gap-4">
                        <div class="p-2 rounded-lg bg-primary/10 text-primary">
                            <span class="material-symbols-outlined">check_circle</span>
                        </div>
                        <div>
                            <p class="text-xs font-bold uppercase tracking-wider text-[#718d58]">Disponibles</p>
                            <p class="text-xl font-black">@Model.Posts.Count(p => p.Status == flea_WebProj.Models.Enums.ProductStatus.Available)</p>
                        </div>
                    </div>
                    <div class="p-4 bg-white dark:bg-background-dark/50 border border-[#edf1e9] dark:border-white/5 rounded-xl shadow-sm flex items-center gap-4">
                        <div class="p-2 rounded-lg bg-gray-500/10 text-gray-500">
                            <span class="material-symbols-outlined">sell</span>
                        </div>
                        <div>
                            <p class="text-xs font-bold uppercase tracking-wider text-[#718d58]">Vendidos</p>
                            <p class="text-xl font-black">@Model.Posts.Count(p => p.Status == flea_WebProj.Models.Enums.ProductStatus.Sold)</p>
                        </div>
                    </div>
                </div>
            }
        </div>
    </main>
</div>

@section Scripts {
    <script>
        // Simple search filter
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const rows = document.querySelectorAll('tbody tr');
                
                rows.forEach(row => {
                    const title = row.querySelector('td:first-child .font-bold').textContent.toLowerCase();
                    const author = row.querySelector('td:nth-child(3) .font-bold').textContent.toLowerCase();
                    const username = row.querySelector('td:nth-child(3) .text-xs').textContent.toLowerCase();
                    
                    if (title.includes(searchTerm) || author.includes(searchTerm) || username.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
        }
    </script>
}

<style>
    .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #edf1e9;
        border-radius: 10px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #dde5d5;
    }
</style>