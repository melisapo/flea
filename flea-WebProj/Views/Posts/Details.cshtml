@model flea_WebProj.Models.ViewModels.Product.ProductDetailViewModel

@{
    ViewData["Title"] = Model.Title;
}

<main class="max-w-[1200px] mx-auto px-6 lg:px-16 py-10 text-text-main">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">

        <!-- ================= LEFT: GALLERY + DESCRIPTION ================= -->
        <div class="lg:col-span-8 flex flex-col gap-10">

            <!-- ===== Image Gallery ===== -->
            <section class="flex flex-col gap-4">
                <div class="aspect-[16/10] w-full rounded-2xl overflow-hidden bg-white shadow-sm border border-border-soft">
                    @if (Model.Images.Any())
                    {
                        <img id="mainImage"
                             src="@Model.Images.First().Path"
                             class="w-full h-full object-contain"
                             alt="@Model.Title" />
                    }
                    else
                    {
                        <img src="/images/no-image.png"
                             class="w-full h-full object-contain"
                             alt="Sin imagen" />
                    }
                </div>

                @if (Model.Images.Count > 1)
                {
                    <div class="flex gap-4 overflow-x-auto pb-2">
                        @foreach (var image in Model.Images)
                        {
                            <button type="button"
                                    onclick="document.getElementById('mainImage').src='@image.Path'"
                                    class="min-w-[120px] aspect-square rounded-xl bg-white border border-border-soft hover:border-primary transition overflow-hidden">
                                <img src="@image.Path" class="w-full h-full object-cover" alt=""/>
                            </button>
                        }
                    </div>
                }
            </section>

            <!-- ===== Description ===== -->
            <section class="bg-white rounded-2xl p-8 lg:p-12 border border-border-soft shadow-sm">
                <h3 class="text-xl font-bold mb-6">Descripci√≥n</h3>

                <p class="text-text-main/70 leading-relaxed whitespace-pre-line">
                    @Model.Description
                </p>

                @if (Model.Categories.Any())
                {
                    <div class="mt-10 pt-6 border-t border-border-soft flex flex-wrap gap-2">
                        @foreach (var category in Model.Categories)
                        {
                            <span class="px-4 py-1.5 rounded-full bg-background-light border border-primary/20 text-primary text-sm font-medium">
                                @category.Name
                            </span>
                        }
                    </div>
                }
            </section>
        </div>

        <!-- ================= RIGHT: SIDEBAR ================= -->
        <aside class="lg:col-span-4">
            <div class="sticky top-28 flex flex-col gap-6">

                <!-- ===== Main Info Card ===== -->
                <div class="bg-white rounded-2xl p-8 border border-border-soft shadow-sm">
                    <div class="flex flex-col gap-4">
                        <span class="inline-flex self-start px-3 py-1 rounded-full text-xs font-extrabold uppercase tracking-widest
                                     @(Model.Status == flea_WebProj.Models.Enums.ProductStatus.Available
                                       ? "bg-primary/20 text-text-main"
                                       : "bg-gray-200 text-gray-600")">
                            @Model.StatusText
                        </span>

                        <h1 class="text-3xl font-black leading-tight">
                            @Model.Title
                        </h1>

                        <div class="text-4xl font-black">
                            $@Model.Price.ToString("N2")
                        </div>
                    </div>

                    <!-- ===== Actions ===== -->
                    <div class="mt-8 flex flex-col gap-3">
                        @if (Model.Status == flea_WebProj.Models.Enums.ProductStatus.Available && !Model.IsOwner)
                        {
                            <div class="bg-background-light rounded-xl p-4">
                                <p class="text-sm font-bold mb-2">Contacto</p>

                                <p class="text-sm">
                                    üìß <a href="mailto:@Model.AuthorEmail" class="text-primary font-medium">@Model.AuthorEmail</a>
                                </p>

                                @if (!string.IsNullOrEmpty(Model.AuthorPhoneNumber))
                                {
                                    <p class="text-sm mt-1">üìû @Model.AuthorPhoneNumber</p>
                                }

                                @if (!string.IsNullOrEmpty(Model.AuthorTelegramUser))
                                {
                                    <p class="text-sm mt-1">‚úàÔ∏è @@@Model.AuthorTelegramUser</p>
                                }
                            </div>
                        }

                        @if (Model.IsOwner)
                        {
                            <div class="grid grid-cols-2 gap-3">
                                <a asp-action="Edit"
                                   asp-route-id="@Model.PostId"
                                   class="border border-border-soft hover:bg-background-light rounded-xl py-3 text-sm font-bold text-center transition">
                                    Editar
                                </a>

                                <button type="button"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteModal"
                                        class="border border-red-200 text-red-500 hover:bg-red-50 rounded-xl py-3 text-sm font-bold transition">
                                    Eliminar
                                </button>
                            </div>
                        }
                    </div>
                </div>

                <!-- ===== Seller Card ===== -->
                <div class="bg-white rounded-2xl p-6 border border-border-soft shadow-sm">
                    <div class="flex items-center gap-4">
                        <img src="@Model.AuthorProfilePic"
                             class="size-16 rounded-full object-cover ring-4 ring-background-light"
                             alt="@Model.AuthorName" />

                        <div>
                            <a asp-controller="User"
                               asp-action="Profile"
                               asp-route-id="@Model.AuthorId"
                               class="font-extrabold text-lg hover:underline">
                                @Model.AuthorName
                            </a>

                            <p class="text-sm text-text-main/60">
                                @@@Model.AuthorUsername
                            </p>
                        </div>
                    </div>
                </div>

                <!-- ===== Quick Details ===== -->
                <div class="bg-white rounded-2xl p-6 border border-border-soft shadow-sm">
                    <h4 class="text-xs font-bold uppercase tracking-wider text-text-main/50 mb-4">
                        Detalles
                    </h4>

                    <div class="flex flex-col gap-3 text-sm">
                        <div class="flex justify-between">
                            <span class="text-text-main/60">Ubicaci√≥n</span>
                            <span class="font-bold">@Model.AuthorState, @Model.AuthorCountry</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- ===== Metadata ===== -->
    <footer class="mt-16 pt-6 border-t border-border-soft text-sm text-text-main/50 flex flex-col md:flex-row justify-between gap-4">
        <span>
            Publicado el @Model.CreatedAt.ToString("dd/MM/yyyy")
            @if (Model.UpdatedAt.HasValue)
            {
                <span> ‚Ä¢ Actualizado el @Model.UpdatedAt.Value.ToString("dd/MM/yyyy")</span>
            }
        </span>
    </footer>
</main>

<!-- ===== Delete Modal ===== -->
@if (Model.IsOwner)
{
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-red-500 text-white">
                    <h5 class="modal-title">Eliminar publicaci√≥n</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    Esta acci√≥n no se puede deshacer.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <form asp-action="Delete" asp-route-id="@Model.PostId" method="post">
                        <button type="submit" class="btn btn-danger">Eliminar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
}
