@model flea_WebProj.Models.ViewModels.Product.ProductDetailViewModel

@{
    ViewData["Title"] = Model.Title;
}

<main class="flex-1">
    <section class="max-w-7xl mx-auto px-6 md:px-10 lg:px-20 pt-10 pb-4">
        <!-- Hero Section: Image + Main Info -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
            <!-- Main Image -->
            <div class="relative group">
                <div class="aspect-square rounded-3xl overflow-hidden bg-white shadow-lg">
                    @if (Model.Images.Any())
                    {
                        <div id="mainImage"
                             class="w-full h-full transition-transform duration-500">
                            <img src='@Model.Images.First().Path' alt="Product Image" class="w-full h-full object-cover object-center">
                        </div>
                    }
                    else
                    {
                        <div class="grid place-items-center aspect-square rounded-3xl overflow-hidden bg-primary/15 shadow-lg border-2 border-primary/60">
                            <span class="material-symbols-outlined text-6xl text-primary/60">
                                hide_image
                            </span>
                        </div>
                    }
                </div>
            </div>

            <!-- Main Product Info -->
            <div class="flex flex-col justify-center h-full">
                <div class="mb-6">
                    <span class="inline-flex items-center px-4 py-1 rounded-full @(Model.Status == flea_WebProj.Models.Enums.ProductStatus.Available ? "bg-primary/20 text-primary" : "bg-gray-200 text-gray-600") text-[10px] font-black uppercase tracking-[0.2em] mb-4">
                        @Model.StatusText
                    </span>
                    
                    <h2 class="text-4xl md:text-6xl font-extrabold leading-[1.1] text-[#25231e] tracking-tight mb-4">
                        @Model.Title
                    </h2>
                    
                    <div class="text-4xl font-light text-[#758c5a]">
                        $@Model.Price.ToString("N2")
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col gap-4 mt-8">
                    @if (Model is { Status: flea_WebProj.Models.Enums.ProductStatus.Available, IsOwner: false })
                    {
                        <!-- Seller Card -->
        <section class="flex flex-col md:flex-row items-center justify-between gap-10 p-10 bg-[#25231e] rounded-[3rem] text-white">
            <a asp-action="Profile" 
               asp-controller="User" 
               asp-route-id="@Model.AuthorId" class="flex flex-col md:flex-row items-center gap-6">
                <div class="size-20 rounded-full bg-cover bg-center ring-4 ring-[#98cf54]/40 shadow-2xl shadow-[#98cf54]/20" 
                     style="background-image: url('@Model.AuthorProfilePic')"></div>
                <div class="text-center md:text-left">
                    <h4 class="text-2xl font-extrabold">@Model.AuthorName</h4>
                    <p class="text-[#98cf54] font-medium text-sm">@@@Model.AuthorUsername</p>
                </div>
            </a>
            
            @if (Model is { Status: flea_WebProj.Models.Enums.ProductStatus.Available, IsOwner: false })
            {
                <div class="flex gap-3">
                    @if (!string.IsNullOrEmpty(Model.AuthorEmail))
                    {
                        <a href="mailto:@Model.AuthorEmail"
                           class="size-12 rounded-full bg-white/10 hover:bg-[#98cf54] hover:text-[#25231e] transition-all flex items-center justify-center">
                            <span class="material-symbols-outlined text-xl">mail</span>
                        </a>
                    }
                    @if (!string.IsNullOrEmpty(Model.AuthorPhoneNumber))
                    {
                        <a href="tel:@Model.AuthorPhoneNumber"
                           class="size-12 rounded-full bg-white/10 hover:bg-[#98cf54] hover:text-[#25231e] transition-all flex items-center justify-center">
                            <span class="material-symbols-outlined text-xl">call</span>
                        </a>
                    }
                    @if (!string.IsNullOrEmpty(Model.AuthorTelegramUser))
                    {
                        <a href="https://t.me/@Model.AuthorTelegramUser" target="_blank"
                           class="size-12 rounded-full bg-white/10 hover:bg-[#98cf54] hover:text-[#25231e] transition-all flex items-center justify-center">
                            <span class="material-symbols-outlined text-xl">send</span>
                        </a>
                    }
                </div>
            }
        </section>
                    }
                    @if (Model.IsOwner)
                    {
                        <div class="flex items-center gap-3">
                            <a asp-action="Edit" 
                               asp-route-id="@Model.PostId"
                               class=" w-full py-4 text-white bg-primary hover:bg-primary/80 rounded-2xl font-bold transition-all flex items-center justify-center gap-2">
                                <span class="material-symbols-outlined text-xl">edit</span>
                                <span>Editar</span>
                            </a>
                            <form asp-action="Delete" asp-route-id="@Model.PostId" method="post" class="inline">
                                <button type="submit" 
                                        class="py-4 px-8 rounded-2xl border-2 border-destructive bg-destructive/10 text-destructive font-bold hover:bg-destructive hover:text-white transition-all">
                                    Eliminar
                                </button>
                            </form>
                        </div>
                    }
                </div>
            </div>
        </div>
    </section>

    <!-- Thumbnail Gallery -->
    @if (Model.Images.Count > 1)
    {
        <section class="mb-8">
            <div class="max-w-7xl mx-auto px-6 md:px-10 lg:px-20">
                <div class="flex gap-4 overflow-x-auto py-6 scrollbar-hide snap-x">
                    @foreach (var image in Model.Images)
                    {
                        <div onclick="document.getElementById('mainImage').style.backgroundImage = 'url(@image.Path)'"
                             class="min-w-[140px] md:min-w-[200px] aspect-[4/3] rounded-2xl bg-white shadow-md overflow-hidden cursor-pointer snap-start hover:border-[#98cf54]/50 border-2 border-transparent transition-all">
                            <div class="w-full h-full bg-center bg-cover" style="background-image: url('@image.Path')"></div>
                        </div>
                    }
                </div>
            </div>
        </section>
    }

    <!-- Description & Details Section -->
    <div class="max-w-4xl mx-auto px-6 py-6 flex flex-col gap-8">
        <!-- Description -->
        <section class="space-y-6">
            <div class="flex flex-col gap-2">
                <h3 class="text-xs font-black uppercase tracking-[0.3em] text-[#758c5a]">Detalles</h3>
                <h4 class="text-3xl font-extrabold text-[#25231e]">Descripción del Producto</h4>
            </div>
            
            <div class="text-[#25231e]/80 leading-relaxed text-lg space-y-6 font-light whitespace-pre-line">
                @Model.Description
            </div>

            @if (Model.Categories.Any())
            {
                <div class="flex flex-wrap gap-3">
                    @foreach (var category in Model.Categories)
                    {
                        <span class="px-5 py-2 rounded-full bg-[#f9fcf3] border border-[#98cf54]/20 text-[#758c5a] text-sm font-semibold">
                            @category.Name
                        </span>
                    }
                </div>
            }
        </section>

        <!-- Quick Info Grid -->
        <section class="grid grid-cols-1 sm:grid-cols-3 gap-8 p-10 bg-white rounded-3xl shadow-xl border border-[#25231e]/5">
            <div class="flex flex-col gap-2 md:border-r border-[#eef1e9] last:border-0 md:pr-4">
                <span class="text-xs font-black uppercase tracking-widest text-[#7A808A]">Estado</span>
                <span class="text-lg font-bold text-[#25231e]">@Model.StatusText</span>
            </div>
            <div class="flex flex-col gap-2 md:border-r border-[#eef1e9] last:border-0 md:pr-4">
                <span class="text-xs font-black uppercase tracking-widest text-[#7A808A]">Ubicación</span>
                <span class="text-lg font-bold text-[#25231e]">@Model.AuthorState, @Model.AuthorCountry</span>
            </div>
            <div class="flex flex-col gap-2 last:border-0">
                <span class="text-xs font-black uppercase tracking-widest text-[#7A808A]">Publicado</span>
                <span class="text-lg font-bold text-[#25231e]">@Model.CreatedAt.ToString("dd/MM/yyyy")</span>
            </div>
        </section>

        
    </div>

    <!-- Footer Metadata -->
    <footer class="max-w-7xl mx-auto px-6 mt-4 pt-4 border-t border-[#eef1e9] flex flex-col md:flex-row md:gap-6 justify-between items-center gap-4 text-mutedForeground text-[12px] font-black tracking-[0.2em] pb-2">
        <div class="flex flex-col md:flex-row md:gap-6 items-center gap-4">
            <div class="flex items-center gap-3">
                <span class="material-symbols-outlined text-base">event</span>
                Publicado el @Model.CreatedAt.ToString("dd 'de' MMMM, yyyy")
            </div>
            @if (Model.UpdatedAt.HasValue)
            {
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-base">update</span>
                    Actualizado el @Model.UpdatedAt.Value.ToString("dd 'de' MMMM, yyyy")
                </div>
            }
        </div>
        <div class="flex items-center gap-3 hover:text-destructive transition-colors">
            <span class="material-symbols-outlined text-[18px]"> report </span>
            <a asp-action="Report" asp-route-id="@Model.PostId">Reportar publicacion</a>
        </div>
    </footer>
</main>

<!-- Delete Modal -->
@if (Model.IsOwner)
{
    <div id="deleteModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl max-w-md w-full overflow-hidden shadow-2xl">
            <div class="bg-red-500 text-white p-6">
                <div class="flex justify-between items-center">
                    <h5 class="text-xl font-bold">Eliminar publicación</h5>
                    <button type="button" 
                            onclick="document.getElementById('deleteModal').classList.add('hidden')"
                            class="text-white hover:text-white/80">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <p class="text-[#25231e] mb-6">Esta acción no se puede deshacer. ¿Estás seguro de que deseas eliminar esta publicación?</p>
                <div class="flex gap-3 justify-end">
                    <button type="button" 
                            onclick="document.getElementById('deleteModal').classList.add('hidden')"
                            class="px-6 py-3 rounded-xl border border-[#e3e6d9] text-[#25231e] font-bold hover:bg-[#f9fcf3] transition-all">
                        Cancelar
                    </button>
                    <form asp-action="Delete" asp-route-id="@Model.PostId" method="post" class="inline">
                        <button type="submit" 
                                class="px-6 py-3 rounded-xl bg-red-500 text-white font-bold hover:bg-red-600 transition-all">
                            Eliminar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
}

<style>
    .material-symbols-outlined {
        font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }
    
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
    
    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
</style>